@model CreatePostViewModel

@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@{
    ViewData["Title"] = "New post";
}

<div id="new_post" class="w-full mb-4 rounded-xl bg-white p-5 shadow scroll-mt-16">
    <span asp-validation-for="@Model.Text" class="text-red-500"></span>
    <div class="flex justify-between">
        <div class="mr-3">          
            <partial name="User/_SmallProfilePicture" model="new ReadUserViewModel(await UserManager.GetUserAsync(User) ?? throw new UnauthorizedAccessException())" />
        </div>
        <div class="w-full my-auto">
            <form asp-action="Create"> 
                <div>
                    <div class="relative">
                        <div id="textHighlight" class="w-full px-3 rounded whitespace-pre-line absolute top-0 left-0"></div>
                        <textarea asp-for="@Model.Text" id="textInsert" placeholder="What's on your mind?" class="w-full px-3 mb-2 whitespace-pre-line caret-gray-900 text-transparent bg-transparent relative resize-none focus:outline-0"></textarea>
                    </div>
                </div>
                <div class="flex justify-between pl-3">
                    <div class="my-auto">
                        <ul class="flex">
                            @*Add types of content media*@
                        </ul>
                    </div>
                    <div>
                        <button id="login-submit" type="submit" class="rounded-full bg-orange-400 px-3 py-2 w-32 font-semibold text-white hover:bg-orange-500">Post</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">
        document.getElementById("textInsert").setAttribute('style', 'height:' + (this.scrollHeight) + 'px;overflow-y:hidden;');
        
        document.getElementById("textInsert").addEventListener('input', function(){
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        })

        document.getElementById("textInsert").addEventListener("input", function(){
            var text = document.getElementById("textInsert").value;
            var highlightedText = text.replace(/\B([#@@][a-zA-Z0-9(_)]+\b)/g, '<mention class="text-orange-400">$&</mention>');
            document.getElementById("textHighlight").innerHTML = highlightedText;
        })
    </script>
}